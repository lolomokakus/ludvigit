#!/usr/bin/env python3
# Fakes a Windows pre-8 BSoD.
# A Python clone of Folkert van Heusden's original C program: https://www.vanheusden.com/bsod/

# Copyright Â© 2016 Ludvig Holtze <ludvighg1999@gmail.com>
# This program is free software. It comes without any warranty, to
# the extent permitted by applicable law. You can redistribute it
# and/or modify it under the terms of the Do What The Fuck You Want
# To Public License, Version 2, as published by Sam Hocevar.
# See http://www.wtfpl.net/ for more details.

import curses
import random
import sys

def randomSysfile(argument = "midsummer"): # Generates a random system file name
    if argument == "halloween":
        sysfiles = [
            "HALOWEEN.SYS"
            ]
    else:
        sysfiles = [
            "1394BUS.SYS",
            "AC97INTC.SYS",
            "ACPI.SYS",
            "ACPIEC.SYS",
            "ADIHDAUD.SYS",
            "ADPU160M.SYS",
            "AEAUDIO.SYS",
            "AEC.SYS",
            "AEGISP.SYS",
            "AFD.SYS",
            "AHA154X.SYS",
            "AIC78U2.SYS",
            "AIC78XX.SYS",
            "ALIIDE.SYS",
            "AMDK6.SYS",
            "AMDK7.SYS",
            "AMSINT.SYS",
            "ANC.SYS",
            "ANSI.SYS",
            "ARP1394.SYS",
            "ASC.SYS",
            "ASC3350P.SYS",
            "ASC3550.SYS",
            "ASYNCMAC.SYS",
            "ATAPI.SYS",
            "ATI2MTAG.SYS",
            "ATMARPC.SYS",
            "ATMELTPM.SYS",
            "ATMEPVC.SYS",
            "ATMLANE.SYS",
            "ATMUNI.SYS",
            "AUDSTUB.SYS",
            "B57XP32.SYS",
            "BATTC.SYS",
            "BCBTHUB.SYS",
            "BEEP.SYS",
            "BLUESCREEN.SYS",
            "BRIDGE.SYS",
            "BTAUDIO.SYS",
            "BTKRNL.SYS",
            "BTPORT.SYS",
            "BTSERIAL.SYS",
            "BTSLBCSP.SYS",
            "BTWDNDIS.SYS",
            "BTWUSB.SYS",
            "CBIDF2K.SYS",
            "CCDECODE.SYS",
            "CD20XRNT.SYS",
            "CDAUDIO.SYS",
            "CDFS.SYS",
            "CDR4_XP.SYS",
            "CDRALW2K.SYS",
            "CDROM.SYS",
            "CINEMST2.SYS",
            "CLASSPNP.SYS",
            "CMBATT.SYS",
            "CMDIDE.SYS",
            "COMPBATT.SYS",
            "COUNTRY.SYS",
            "CPQARRAY.SYS",
            "CPQDAP01.SYS",
            "CRUSOE.SYS",
            "DAC2W2K.SYS",
            "DAC960NT.SYS",
            "DISK.SYS",
            "DISKDUMP.SYS",
            "DMBOOT.SYS",
            "DMIO.SYS",
            "DMLOAD.SYS",
            "DMUSIC.SYS",
            "DPTI2O.SYS",
            "DRMK.SYS",
            "DRMKAUD.SYS",
            "DXAPI.SYS",
            "DXG.SYS",
            "DXGTHK.SYS",
            "E100B325.SYS",
            "ELBYCDFL.SYS",
            "ELBYCDIO.SYS",
            "ENUM1394.SYS",
            "FASTFAT.SYS",
            "FDC.SYS",
            "FIPS.SYS",
            "FLPYDISK.SYS",
            "FLTMGR.SYS",
            "FS_REC.SYS",
            "FSVGA.SYS",
            "FTDISK.SYS",
            "HCMON.SYS",
            "HDAUDBUS.SYS",
            "HDAUDIO.SYS",
            "HIDCLASS.SYS",
            "HIDCOM.SYS",
            "HIDPARSE.SYS",
            "HIDUSB.SYS",
            "HIMEM.SYS",
            "HPN.SYS",
            "HSX_CNXT.SYS",
            "HSX_DPV.SYS",
            "HSXHWAZL.SYS",
            "HTTP.SYS",
            "I2OMGMT.SYS",
            "I2OMP.SYS",
            "I8042PRT.SYS",
            "IKHFILE.SYS",
            "IKHLAYER.SYS",
            "IMAGEDRV.SYS",
            "IMAGESRV.SYS",
            "IMAPI.SYS",
            "INI910U.SYS",
            "INTELIDE.SYS",
            "INTELPPM.SYS",
            "IP6FW.SYS",
            "IPFLTDRV.SYS",
            "IPINIP.SYS",
            "IPNAT.SYS",
            "IPSEC.SYS",
            "IRDA.SYS",
            "IRENUM.SYS",
            "ISAPNP.SYS",
            "KBDCLASS.SYS",
            "KBDHID.SYS",
            "KEY01.SYS",
            "KEYBOARD.SYS",
            "KMIXER.SYS",
            "KS-959.SYS",
            "KS.SYS",
            "KSECDD.SYS",
            "LUIPSEC.SYS",
            "MCD.SYS",
            "MDMXSDK.SYS",
            "MF.SYS",
            "MNMDD.SYS",
            "MODEM.SYS",
            "MOUCLASS.SYS",
            "MOUHID.SYS",
            "MOUNTMGR.SYS",
            "MQAC.SYS",
            "MRAID35X.SYS",
            "MRXDAV.SYS",
            "MRXSMB.SYS",
            "MSFS.SYS",
            "MSGPC.SYS",
            "MSKSSRV.SYS",
            "MSPCLOCK.SYS",
            "MSPQM.SYS",
            "MSSMBIOS.SYS",
            "MSTEE.SYS",
            "MUP.SYS",
            "NABTSFEC.SYS",
            "NDIS.SYS",
            "NDISIP.SYS",
            "NDISTAPI.SYS",
            "NDISUIO.SYS",
            "NDISWAN.SYS",
            "NDPROXY.SYS",
            "NETBIOS.SYS",
            "NETBT.SYS",
            "NIC1394.SYS",
            "NIKEDRV.SYS",
            "NMNT.SYS",
            "NMWCD.SYS",
            "NMWCDC.SYS",
            "NMWCDCJ.SYS",
            "NMWCDCM.SYS",
            "NPF.SYS",
            "NPFS.SYS",
            "NSNDIS5.SYS",
            "NTDOS.SYS",
            "NTDOS404.SYS",
            "NTDOS411.SYS",
            "NTDOS412.SYS",
            "NTDOS804.SYS",
            "NTFS.SYS",
            "NTIO.SYS",
            "NTIO404.SYS",
            "NTIO411.SYS",
            "NTIO412.SYS",
            "NTIO804.SYS",
            "NULL.SYS",
            "NV4_MINI.SYS",
            "NWLNKFLT.SYS",
            "NWLNKFWD.SYS",
            "NWLNKIPX.SYS",
            "NWLNKNB.SYS",
            "NWLNKSPX.SYS",
            "NWRDR.SYS",
            "OHCI1394.SYS",
            "OPRGHDLR.SYS",
            "P3.SYS",
            "PARPORT.SYS",
            "PARTMGR.SYS",
            "PARVDM.SYS",
            "PCDRNDISUIO.SYS",
            "PCI.SYS",
            "PCIIDE.SYS",
            "PCIIDEX.SYS",
            "PCMCIA.SYS",
            "PERC2.SYS",
            "PERC2HIB.SYS",
            "PORTCLS.SYS",
            "PQNTDRV.SYS",
            "PROCESSR.SYS",
            "PSADD.SYS",
            "PSCHED.SYS",
            "PTILINK.SYS",
            "PXHELP20.SYS",
            "QL1080.SYS",
            "QL10WNT.SYS",
            "QL12160.SYS",
            "QL1240.SYS",
            "QL1280.SYS",
            "RASACD.SYS",
            "RASIRDA.SYS",
            "RASL2TP.SYS",
            "RASPPPOE.SYS",
            "RASPPTP.SYS",
            "RASPTI.SYS",
            "RAWWAN.SYS",
            "RDBSS.SYS",
            "RDPCDD.SYS",
            "RDPDR.SYS",
            "RDPWD.SYS",
            "REDBOOK.SYS",
            "RIO8DRV.SYS",
            "RIODRV.SYS",
            "RMCAST.SYS",
            "RNDISMP.SYS",
            "ROOTMDM.SYS",
            "S24TRANS.SYS",
            "SCSIPORT.SYS",
            "SDBUS.SYS",
            "SECDRV.SYS",
            "SERENUM.SYS",
            "SERIAL.SYS",
            "SFFDISK.SYS",
            "SFFP_SD.SYS",
            "SFLOPPY.SYS",
            "SFTPDRIVE.SYS",
            "SHOCKMGR.SYS",
            "SHOCKPRF.SYS",
            "SLIP.SYS",
            "SMCLIB.SYS",
            "SONYDCAM.SYS",
            "SPARROW.SYS",
            "SPLITTER.SYS",
            "SPTD.SYS",
            "SPTDDRV1.SYS",
            "SR.SYS",
            "SRV.SYS",
            "SSI.SYS",
            "STREAM.SYS",
            "STREAMIP.SYS",
            "SWENUM.SYS",
            "SWMIDI.SYS",
            "SYM_HI.SYS",
            "SYM_U3.SYS",
            "SYMC810.SYS",
            "SYMC8XX.SYS",
            "SYNTP.SYS",
            "SYSAUDIO.SYS",
            "TAPE.SYS",
            "TCPIP.SYS",
            "TCPIP6.SYS",
            "TCUSB.SYS",
            "TDI.SYS",
            "TDPIPE.SYS",
            "TDTCP.SYS",
            "TERMDD.SYS",
            "TOSDVD.SYS",
            "TOSIDE.SYS",
            "TPHKDRV.SYS",
            "TSBVCAP.SYS",
            "TUNMP.SYS",
            "UDFS.SYS",
            "ULTRA.SYS",
            "UPDATE.SYS",
            "USB8023.SYS",
            "USBCAMD.SYS",
            "USBCAMD2.SYS",
            "USBCCGP.SYS",
            "USBD.SYS",
            "USBEHCI.SYS",
            "USBHUB.SYS",
            "USBINTEL.SYS",
            "USBKEY.SYS",
            "USBPORT.SYS",
            "USBPRINT.SYS",
            "USBSCAN.SYS",
            "USBUHCI.SYS",
            "USBVM31B.SYS",
            "VDMINDVD.SYS",
            "VGA.SYS",
            "VIAIDE.SYS",
            "VIDEOPRT.SYS",
            "VMNET.SYS",
            "VMNETADAPTER.SYS",
            "VMNETBRIDGE.SYS",
            "VMNETUSERIF.SYS",
            "VMX86.SYS",
            "VOLSNAP.SYS",
            "W29N50.SYS",
            "W29N51.SYS",
            "W39N50.SYS",
            "W39N51.SYS",
            "WANARP.SYS",
            "WATCHDOG.SYS",
            "WBPCM.SYS",
            "WBUSB.SYS",
            "WDMAUD.SYS",
            "WIN32K.SYS",
            "WMILIB.SYS",
            "WPDUSB.SYS",
            "WS2IFSL.SYS",
            "WSTCODEC.SYS",
            "WUDFPF.SYS",
            "WUDFRD.SYS"
            ]
    return random.choice(sysfiles)

def randomError(argument = "midsummer"): # Generates a random stop error
    if argument == "halloween":
        errors = [
            "EMBRACE_EXTEND_EXTINGUISH"
            ]
    else:
        errors = [
            "ACPI_DRIVER_INTERNAL",
            "ASSIGN_DRIVE_LETTERS_FAILED",
            "ATDISK_DRIVER_INTERNAL",
            "BAD_EXHANDLE",
            "BAD_POOL_CALLER",
            "BAD_SYSTEM_CONFIG_INFO",
            "BOUND_IMAGE_UNSUPPORTED",
            "BUGCODE_USB_DRIVER",
            "CACHE_INITIALIZATION_FAILED",
            "CANCEL_STATE_IN_COMPLETED_IRP",
            "CANNOT_WRITE_CONFIGURATION",
            "CONFIG_INITIALIZATION_FAILED",
            "CONFIG_LIST_FAILED",
            "CRITICAL_SERVICE_FAILED",
            "DATA_COHERENCY_EXCEPTION",
            "DEREF_UNKNOWN_LOGON_SESSION",
            "DFS_FILE_SYSTEM",
            "DRIVER_CORRUPTED_MMPOOL",
            "DRIVER_IRQL_NOT_LESS_OR_EQUAL",
            "DRIVER_LEFT_LOCKED_PAGES_IN_PROCESS",
            "DRIVER_POWER_STATE_FAILURE",
            "DRIVER_UNLOADED_WITHOUT_CANCELLING_PENDING_OPERATIONS",
            "END_OF_NT_EVALUATION_PERIOD",
            "FATAL_UNHANDLED_HARD_ERROR",
            "FILE_INITIALIZATION_FAILED",
            "FLTMGR_FILE_SYSTEM",
            "FP_EMULATION_ERROR",
            "FTDISK_INTERNAL_ERROR",
            "HAL1_INITIALIZATION_FAILED",
            "HAL_INITIALIZATION_FAILED",
            "INSTALL_MORE_MEMORY",
            "INSTRUCTION_COHERENCY_EXCEPTION",
            "INSUFFICIENT_SYSTEM_MAP_REGS",
            "INTERNAL_POWER_ERROR",
            "INVALID_KERNEL_HANDLE",
            "INVALID_REGION_OR_SEGMENT",
            "INVALID_WORK_QUEUE_ITEM",
            "IO1_INITIALIZATION_FAILED",
            "IRQL_GT_ZERO_AT_SYSTEM_SERVICE",
            "KERNEL_DATA_INPAGE_ERROR",
            "KERNEL_MODE_EXCEPTION_NOT_HANDLED",
            "KERNEL_STACK_INPAGE_ERROR",
            "KERNEL_STACK_LOCKED_AT_EXIT",
            "LM_SERVER_INTERNAL_ERROR",
            "LPC_INITIALIZATION_FAILED",
            "MACHINE_CHECK_EXCEPTION",
            "MAILSLOT_FILE_SYSTEM",
            "MEMORY1_INITIALIZATION_FAILED",
            "MULTIPLE_IRP_COMPLETE_REQUESTS",
            "MUST_SUCCEED_POOL_EMPTY",
            "MUTEX_ALREADY_OWNED",
            "NDIS_INTERNAL_ERROR",
            "NO_BOOT_DEVICE",
            "NO_PAGES_AVAILABLE",
            "NO_SUCH_PARTITION",
            "OBJECT1_INITIALIZATION_FAILED",
            "OBJECT_INITIALIZATION_FAILED",
            "OFS_FILE_SYSTEM",
            "PAGE_FAULT_IN_NONPAGED_AREA",
            "PAGE_FAULT_WITH_INTERRUPTS_OFF",
            "PFN_LIST_CORRUPT",
            "PHASE0_EXCEPTION",
            "PINBALL_FILE_SYSTEM",
            "PNP_INTERNAL_ERROR",
            "PP0_INITIALIZATION_FAILED",
            "PP1_INITIALIZATION_FAILED",
            "PROCESS1_INITIALIZATION_FAILED",
            "PROCESS_HAS_LOCKED_PAGES",
            "PROCESS_INITIALIZATION_FAILED",
            "RECOM_DRIVER",
            "REFMON_INITIALIZATION_FAILED",
            "REF_UNKNOWN_LOGON_SESSION",
            "REGISTRY_ERROR",
            "SECURITY1_INITIALIZATION_FAILED",
            "SECURITY_INITIALIZATION_FAILED",
            "SESSION1_INITIALIZATION_FAILED",
            "SESSION2_INITIALIZATION_FAILED",
            "SESSION3_INITIALIZATION_FAILED",
            "SESSION4_INITIALIZATION_FAILED",
            "SESSION5_INITIALIZATION_FAILED",
            "SESSION_HAS_VALID_POOL_ON_EXIT",
            "SESSION_HAS_VALID_SPECIAL_POOL_ON_EXIT",
            "SESSION_HAS_VALID_VIEWS_ON_EXIT",
            "SET_ENV_VAR_FAILED",
            "SETUP_FAILURE",
            "SPECIAL_POOL_DETECTED_MEMORY_CORRUPTION",
            "SPIN_LOCK_INIT_FAILURE",
            "STREAMS_INTERNAL_ERROR",
            "SYMBOLIC_INITIALIZATION_FAILED",
            "SYSTEM_LICENSE_VIOLATION",
            "SYSTEM_THREAD_EXCEPTION_NOT_HANDLED",
            "TARGET_MDL_TOO_SMALL",
            "TERMINAL_SERVER_DRIVER_MADE_INCORRECT_MEMORY_REFERENCE",
            "UDFS_FILE_SYSTEM",
            "UNMOUNTABLE_BOOT_VOLUME",
            "UNSUPPORTED_PROCESSOR",
            "UP_DRIVER_ON_MP_SYSTEM",
            "WIN32K_INIT_OR_RIT_FAILURE",
            "WORKER_THREAD_RETURNED_AT_BAD_IRQL",
            "XNS_INTERNAL_ERROR"
            ]
    return random.choice(errors)

def randomHex(): # Generates a random hex number (0 to ffffffff)
    return "{:08x}".format(random.randint(1, 4294967295)).upper()

def main(stdscr):
    try:
        y, x = stdscr.getmaxyx()
        if y < 28 or x < 76: # Check if terminal is big enough
            return 2 # Return values are processed later

        random.seed() # Seed the RNG

        if curses.has_colors(): # Check if the terminal has color support
            curses.init_pair(1, curses.COLOR_WHITE, curses.COLOR_BLUE) # If so, set the default colors
            stdscr.bkgd(curses.color_pair(1))
            stdscr.attron(curses.A_BOLD) # **BOLD TEXT**

        sysfile = randomSysfile()
        error = randomError()
        # We can't generate a random hex number this way because we need several different ones

        for argument in sys.argv:
            if argument == "--halloween": # Check for spooky arguments
                sysfile = randomSysfile("halloween")
                error = randomError("halloween")

        stdscr.clear() # Let's go!
        stdscr.addstr(1, 0, "A problem has been detected and Windows has been shut down to prevent damage")
        stdscr.addstr(2, 0, "to your computer.")
        stdscr.addstr(4, 0, "The problem seems to be caused by the following file: " + sysfile)
        stdscr.addstr(6, 0, error)
        stdscr.addstr(8, 0, "If this is the first time you've seen this Stop error screen,")
        stdscr.addstr(9, 0, "restart your computer. If this screen appears again, follow")
        stdscr.addstr(10, 0, "these steps:")
        stdscr.addstr(12, 0, "Check to make sure any new hardware or software is properly installed.")
        stdscr.addstr(13, 0, "If this is a new installation, ask your hardware or software manufacturer")
        stdscr.addstr(14, 0, "for any Windows updates you might need.")
        stdscr.addstr(16, 0, "If problems continue, disable or remove any newly installed hardware")
        stdscr.addstr(17, 0, "or software. Disable BIOS memory options such as caching or shadowing.")
        stdscr.addstr(18, 0, "If you need to use Safe Mode to remove or disable components, restart")
        stdscr.addstr(19, 0, "your computer, press F8 to select Advanced Startup Options, and then")
        stdscr.addstr(20, 0, "select Safe Mode.")
        stdscr.addstr(22, 0, "Technical information:")
        stdscr.addstr(24, 0, "*** STOP: 0x" + randomHex() + " (0x" + randomHex() + ",0x" + randomHex() + ",0x" + randomHex() + ",0x" + randomHex() + ")")
        stdscr.addstr(27, 0, "***  " + sysfile + " - Address " + randomHex() + " base at " + randomHex() + ", DateStamp " + randomHex())
        stdscr.addstr(y - 1, x - 1, "") # Moves the cursor to the lower right corner

        stdscr.getch() # Wait for keypress
        return 0

    except(KeyboardInterrupt): # Handle Ctrl+C gracefully
        return 1

status = curses.wrapper(main)
# 0 = OK
# 1 = KeyboardInterrupt
# 2 = Terminal is too small
if status == 2:
    print("Your terminal is too small! (Need at least 76x28)")

exit(status)
