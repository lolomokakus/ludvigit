#!/usr/bin/env bash

ENGINE=bing
LANGUAGES=(af ar bg bn bs ca cs cy da de el en es et fa fi fj fr he hi hr ht hu id it ja ko lt lv mg ms mt nl no otq pl pt ro ru sk sl sm sr-Cyrl sv sw th tlh-Qaak to tr ty uk ur vi yua yue zh-TW)
DEFAULTLANG=en
PASSES=30
DELAY=2
VERBOSE=false

function stop_early() {
  if [[ $VERBOSE != true ]] ; then
    echo "$STRING"
  fi
  exit 1
}

trap stop_early SIGINT SIGTERM

if [[ -z "$1" ]] ; then
  STRING="Please enter a string to make nonsense out of."
else
  STRING="$1"
fi

echo "$STRING"

if [[ -z "$2" ]] ; then
	originalLanguage=$DEFAULTLANG
else
	originalLanguage="$2"
fi

pass=0
while [[ $pass -lt $PASSES ]] ; do
  selectedLanguage=$((RANDOM % ${#LANGUAGES[@]} - 1))
  while [[ ${LANGUAGES[$selectedLanguage]} = "$originalLanguage" ]] ; do
    selectedLanguage=$((RANDOM % ${#LANGUAGES[@]} - 1))
  done
  STRING=$(trans -engine $ENGINE -brief -no-autocorrect ${LANGUAGES[$selectedLanguage]}:"$originalLanguage" -- "$(trans -engine $ENGINE -brief -no-autocorrect "$originalLanguage":${LANGUAGES[$selectedLanguage]} -- "$STRING")")
  if [[ $VERBOSE = true ]] ; then
    echo "$STRING"
  else
    echo -n "."
  fi
  ((pass++))
  if [[ $pass -ne $PASSES ]] ; then
    sleep $DELAY
  fi
done

if [[ $VERBOSE != true ]] ; then
  echo
  echo "$STRING"
fi

exit 0
